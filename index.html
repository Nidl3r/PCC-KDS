<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="app-build-id" content="2025.0014" />
  <title>PCC KDS</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="offlineBanner" role="status" aria-live="assertive" style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(120deg, #b91c1c, #f97316);
    color: white;
    text-align: center;
    padding: 12px 16px;
    z-index: 1000;
    font-weight: 600;
    letter-spacing: 0.02em;
    box-shadow: 0 6px 14px rgba(0,0,0,0.35);">
    <span aria-hidden="true" style="margin-right: 0.75rem;">ðŸ“¡</span>
    <span id="offlineBannerText">
      Offline Mode â€” changes are saved locally and will sync once you're reconnected.
    </span>
  </div>
  <div class="app-shell">
    <aside class="sidebar" id="sidebar" aria-label="Screen selection">
      <div class="sidebar-header">
        <span class="sidebar-title">Screens</span>
        <button type="button" class="sidebar-toggle" id="sidebarToggle" aria-label="Collapse sidebar">
          <span class="sidebar-toggle-icon" aria-hidden="true"></span>
          <span class="sidebar-toggle-text">Hide</span>
        </button>
      </div>
      <nav class="sidebar-nav" id="sidebarNav">
        <button type="button" class="sidebar-item" data-target="guest-count">Guest Count</button>
        <button type="button" class="sidebar-item" data-target="aloha">Aloha</button>
        <button type="button" class="sidebar-item" data-target="ohana">Ohana</button>
        <button type="button" class="sidebar-item" data-target="gateway">Gateway</button>
        <button type="button" class="sidebar-item" data-target="concession">Concession</button>
        <button type="button" class="sidebar-item" data-target="main-kitchen">Main Kitchen</button>
        <button type="button" class="sidebar-item" data-target="stations">Stations</button>
        <button type="button" class="sidebar-item" data-target="accounting">Accounting</button>
        <button type="button" class="sidebar-item sidebar-item--action" id="fullscreenToggle" aria-pressed="false" aria-label="Enter full screen">
          Full Screen
        </button>
      </nav>
    </aside>
    <div class="sidebar-backdrop" id="sidebarBackdrop" hidden></div>
    <button type="button" class="sidebar-trigger" id="sidebarTrigger" aria-label="Open navigation">
      <span class="sidebar-toggle-icon" aria-hidden="true"></span>
    </button>
    <main class="main-content" id="mainContent">
      <section id="offlineStatusPanel" class="offline-status" aria-live="polite">
        <div class="offline-status__icon" aria-hidden="true">ðŸ“¡</div>
        <div class="offline-status__content">
          <h3>Offline Mode</h3>
          <p id="offlineStatusMessage">
            You're working without a connection. Updates will sync when we reconnect.
          </p>
          <div class="offline-status__actions">
            <button type="button" class="offline-status__retry" id="offlineRetryButton">
              Retry Connection
            </button>
            <span class="offline-status__quality" id="connectionQualityBadge">
              Checking networkâ€¦
            </span>
          </div>
        </div>
      </section>
      <div id="connectionIndicatorChip" class="connection-chip" role="status" aria-live="polite">
        <span class="connection-chip__dot" aria-hidden="true"></span>
        <span id="connectionIndicatorText">Checking connectionâ€¦</span>
      </div>
      <div class="topbar topbar--legacy" aria-hidden="true">
        <select id="viewSelect">
          <option value="guest-count">Guest Count</option>
          <option value="aloha">Aloha</option>
          <option value="ohana">Ohana</option>
          <option value="gateway">Gateway</option>
          <option value="concession">Concession</option>
          <option value="main-kitchen">Main Kitchen</option>
          <option value="stations">Stations</option>
          <option value="accounting">Accounting</option>
        </select>
      </div>

<div class="screen" id="guest-count">
  <h2>Guest Count</h2>
  <form id="guest-count-form" class="form-grid">
    <div id="current-guest-counts" class="guest-count-summary">
  <h3>Current Guest Counts</h3>
  <p>Aloha: <span id="current-Aloha">â€”</span></p>
  <p>Ohana: <span id="current-Ohana">â€”</span></p>
  <p>Gateway: <span id="current-Gateway">â€”</span></p>
</div>

    <div class="form-group">
      <label for="count-Aloha">Aloha Guests</label>
      <select id="count-Aloha" class="styled-select">
        <option value="200">200</option>
        <option value="250">250</option>
        <option value="300">300</option>
        <option value="350">350</option>
      </select>
    </div>

    <div class="form-group">
      <label for="count-Ohana">Ohana Guests</label>
      <select id="count-Ohana" class="styled-select">
        <option value="0">0</option>
        <option value="75">75</option>
        <option value="100">100</option>
        <option value="125">125</option>
        <option value="150">150</option>
        <option value="175">175</option>
      </select>
    </div>

    <div class="form-group">
      <label for="count-Gateway">Gateway Guests</label>
      <select id="count-Gateway" class="styled-select">
        <option value="250">250</option>
        <option value="300">300</option>
        <option value="350">350</option>
        <option value="400">400</option>
        <option value="450">450</option>
        <option value="500">500</option>
        <option value="550">550</option>
        <option value="600">600</option>
        <option value="650">650</option>
        <option value="700">700</option>
        <option value="750">750</option>
        <option value="800">800</option>
        <option value="850">850</option>
        <option value="900">900</option>
        <option value="950">950</option>
        <option value="1000">1000</option>
      </select>
    </div>

    <button type="submit" class="save-btn">Save Guest Counts</button>
    <p id="guest-count-lock-message" class="guest-count-note"></p>
  </form>

  <div id="guest-count-status"></div>
</div>





<!-- âœ… Aloha Screen (fixed) -->
<div class="screen" id="aloha">
  <div class="header-container">
    <h2>Aloha</h2>
    <div class="area-tabs">
      <button class="area-tab" data-area="aloha" data-sec="order" onclick="showAreaSection('aloha','order')">Add-ons</button>
      <button class="area-tab" data-area="aloha" data-sec="starting" onclick="showAreaSection('aloha','starting')">Starting Par</button>
      <!--<button class="area-tab" data-area="aloha" data-sec="waste" onclick="showAreaSection('aloha','waste')">Waste</button> -->
      <button class="area-tab" data-area="aloha" data-sec="returns" onclick="showAreaSection('aloha','returns')">Returns</button>
    </div>
    <button type="button" class="collapse-toggle" data-target="aloha" aria-expanded="true" aria-label="Collapse section" title="Collapse section">-</button>
  </div>

<div class="collapsible-content" data-screen="aloha">
<!-- âžŠ Add-Ons -->
<div class="aloha-section" data-sec="order">
  <div class="order-controls">
    <label>
      Section:
      <select id="alohaCategory" onchange="applyCategoryFilter('aloha')"> 
        <option value="">All</option>
        <option value="HOTFOODS">Hotfoods</option>
        <option value="PANTRY">Pantry</option>
        <option value="BAKERY">Bakery</option>
      </select>
    </label>

    <select id="alohaItem">
      <option value="">-- Select Item --</option>
    </select>

    <input id="alohaQty" type="number" min="1" value="1" placeholder="1" />
    <input id="alohaNotes" type="text" placeholder="Notes (e.g. no tomato)" />
    <button onclick="sendAlohaOrder(this)">Send</button>
  </div>

  <!-- ðŸ’° Cost Summary + Live Guests -->
  <div style="display: flex; align-items: center; gap: 2rem; justify-content: space-between; margin-top: 1rem;">
    <h3>Open Orders</h3>
    <div id="alohaCostSummary" style="font-size: 1rem; display: flex; align-items: center; gap: 1.5rem;">
      <div>
        <strong>Total Spent:</strong>
        $<span id="totalSpent">0.00</span>
      </div>

      <!-- âœ… read-only counts -->
      <div>
        <strong>Remaining Guests:</strong>
        <span id="alohaRemainingGuests">0</span>
      </div>

      <div>
        <strong>Total Guests:</strong>
        <span id="alohaTotalGuests">0</span>
      </div>

      <div>
        <strong>Cost per Guest:</strong>
        $<span id="costPerGuest">0.00</span>
      </div>
    </div>
  </div>

  <table id="alohaTable">
    <thead>
      <tr>
        <th>Time</th>
        <th>Due</th>
        <th>Item</th>
        <th>Qty</th>
        <th>Status</th>
        <th>Receive</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>


  <!-- âž‹ Starting Par -->
  <div class="aloha-section" data-sec="starting" style="display:none">
    <h3>Starting Par</h3>
    <p id="alohaGuestInfo">Loading guest count...</p>

    <div class="order-controls">
      <label>
        Section:
        <select id="aloha-starting-category" onchange="renderStartingStatus('Aloha', startingCache['Aloha'])">
          <option value="">All</option>
          <option>Hotfoods</option>
          <option>Bakery</option>
          <option>Pantry</option>
        </select>
      </label>
    </div>

    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Par Qty</th>
          <th>Sent Qty</th>
          <th>Receive</th>
        </tr>
      </thead>
      <tbody id="alohaParTableBody"></tbody>
    </table>
  </div>

  <!-- âžŒ Waste -->
  <div class="aloha-section" data-sec="waste" style="display:none">
  <h3>Aloha Waste</h3>

  <!-- Category + Search Filters + Send All -->
  <div class="order-controls">
    <!-- Category Dropdown -->
    <label for="aloha-waste-category" style="margin-right: 12px;">
      Filter by Category:
      <select id="aloha-waste-category" onchange="filterAlohaWaste()">
        <option value="">All Categories</option>
        <option value="Hotfoods">Hotfoods</option>
        <option value="Bakery">Bakery</option>
        <option value="Pantry">Pantry</option>
        <!-- Add more options as needed -->
      </select>
    </label>

    <!-- Search Input -->
    <label for="alohaWasteSearch" style="margin-right: 12px;">
      Search:
      <input type="text" id="alohaWasteSearch" placeholder="Search items..." oninput="filterAlohaWaste()" />
    </label>

    <!-- Send All Button -->
    <button onclick="sendAllWaste()">Send All Waste</button>
  </div>

  <div class="waste-table-wrapper">
    <table class="waste-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>UOM</th>
          <th>Qty</th>
          <th>Send</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>


  <!-- âž Returns -->
  <div class="aloha-section returns-section" data-sec="returns" style="display:none">
    <h3>Aloha Returns</h3>
    <table class="aloha-returns-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>Current</th>
          <th>Returned</th>
          <th>Return</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
</div>



  <div class="screen" id="ohana">
  <div class="header-container">
    <h2>Ohana</h2>
    <div class="area-tabs">
      <button class="area-tab" data-area="ohana" data-sec="order" onclick="showAreaSection('ohana','order')">Add-ons</button>
      <button class="area-tab" data-area="ohana" data-sec="starting" onclick="showAreaSection('ohana','starting')">Starting Par</button>
      <!--<button class="area-tab" data-area="ohana" data-sec="waste" onclick="showAreaSection('ohana','waste')">Waste</button> -->
      <button class="area-tab" data-area="ohana" data-sec="returns" onclick="showAreaSection('ohana','returns')">Returns</button>
    </div>
    <button type="button" class="collapse-toggle" data-target="ohana" aria-expanded="true" aria-label="Collapse section" title="Collapse section">-</button>
  </div>

<div class="collapsible-content" data-screen="ohana">
<!-- âžŠ Add-Ons -->
<div class="ohana-section" data-sec="order">
  <div class="order-controls">
    <label>
      Section:
      <select id="ohanaCategory" onchange="applyCategoryFilter('ohana')">
        <option value="">All</option>
        <option value="HOTFOODS">Hotfoods</option>
        <option value="PANTRY">Pantry</option>
        <option value="BAKERY">Bakery</option>
      </select>
    </label>

    <select id="ohanaItem">
      <option value="">-- Select Item --</option>
    </select>

    <input id="ohanaQty" type="number" min="1" value="1" placeholder="1" />
    <input id="ohanaNotes" type="text" placeholder="Notes (e.g. no tomato)" />
    <button onclick="sendOhanaOrder(this)">Send</button>
  </div>

  <div style="display: flex; align-items: center; gap: 2rem; justify-content: space-between; margin-top: 1rem;">
    <h3>Open Orders</h3>

    <div id="ohanaCostSummary" style="font-size: 1rem; display: flex; align-items: center; gap: 1.5rem;">
      <div>
        <strong>Total Spent:</strong>
        $<span id="totalSpentOhana">0.00</span>
      </div>

      <div>
        <strong>Remaining Guests:</strong>
        <span id="ohanaRemainingGuests">0</span>
      </div>

      <div>
        <strong>Total Guests:</strong>
        <span id="ohanaTotalGuests">0</span>
      </div>

      <div>
        <strong>Cost per Guest:</strong>
        $<span id="costPerGuestOhana">0.00</span>
      </div>
    </div>
  </div>

  <table id="ohanaTable">
    <thead>
      <tr>
        <th>Time</th>
        <th>Due</th>
        <th>Item</th>
        <th>Qty</th>
        <th>Status</th>
        <th>Receive</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>



  <!-- âž‹ Starting Par -->
  <div class="ohana-section" data-sec="starting" style="display:none">
    <h3>Starting Par</h3>
    <p id="ohanaGuestInfo">Loading guest count...</p>

    <div class="order-controls">
      <label>
        Section:
        <select id="ohana-starting-category" onchange="renderStartingStatus('Ohana', startingCache['Ohana'])">
          <option value="">All</option>
          <option>Hotfoods</option>
          <option>Bakery</option>
          <option>Pantry</option>
        </select>
      </label>
    </div>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Par Qty</th>
          <th>Sent Qty</th>
          <th>Receive</th>
        </tr>
      </thead>
      <tbody id="ohanaParTableBody"></tbody>
    </table>
  </div>

  <!-- âžŒ Waste -->
  <div class="ohana-section" data-sec="waste" style="display:none">
  <h3>Ohana Waste</h3>

  <div class="order-controls">
    <label for="ohana-waste-category" style="margin-right: 12px;">
      Filter by Category:
      <select id="ohana-waste-category" onchange="filterOhanaWaste()">
        <option value="">All Categories</option>
        <option value="Hotfoods">Hotfoods</option>
        <option value="Bakery">Bakery</option>
        <option value="Pantry">Pantry</option>
        <!-- Add more categories if needed -->
      </select>
    </label>

    <label for="ohanaWasteSearch" style="margin-right: 12px;">
      Search:
      <input type="text" id="ohanaWasteSearch" placeholder="Search items..." oninput="filterOhanaWaste()" />
    </label>

    <button onclick="sendAllOhanaWaste()">Send All Waste</button>
  </div>

  <table class="waste-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>UOM</th>
        <th>Qty</th>
        <th>Send</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

  <!-- âž Returns -->
  <div class="ohana-section returns-section" data-sec="returns" style="display:none">
    <h3>Ohana Returns</h3>
    <table class="ohana-returns-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>Current</th>
          <th>Returned</th>
          <th>Return</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
</div>


  <div class="screen" id="gateway">
  <div class="header-container">
    <h2>Gateway</h2>
    <div class="area-tabs">
      <button class="area-tab" data-area="gateway" data-sec="order" onclick="showAreaSection('gateway','order')">Add-ons</button>
      <button class="area-tab" data-area="gateway" data-sec="starting" onclick="showAreaSection('gateway','starting')">Starting Par</button>
     <!-- <button class="area-tab" data-area="gateway" data-sec="waste" onclick="showAreaSection('gateway','waste')">Waste</button> -->
      <button class="area-tab" data-area="gateway" data-sec="returns" onclick="showAreaSection('gateway','returns')">Returns</button>
    </div>
    <button type="button" class="collapse-toggle" data-target="gateway" aria-expanded="true" aria-label="Collapse section" title="Collapse section">-</button>
  </div>

<div class="collapsible-content" data-screen="gateway">
<!-- âžŠ Add-Ons -->
<div class="gateway-section" data-sec="order">
  <div class="order-controls">
    <label>
      Section:
      <select id="gatewayCategory" onchange="applyCategoryFilter('gateway')">
        <option value="">All</option>
        <option value="HOTFOODS">Hotfoods</option>
        <option value="PANTRY">Pantry</option>
        <option value="BAKERY">Bakery</option>
      </select>
    </label>

    <select id="gatewayItem">
      <option value="">-- Select Item --</option>
    </select>

    <input id="gatewayQty" type="number" min="1" value="1" placeholder="1" />
    <input id="gatewayNotes" type="text" placeholder="Notes (e.g. no tomato)" />
    <button onclick="sendGatewayOrder(this)">Send</button>
  </div>

  <div style="display: flex; align-items: center; gap: 2rem; justify-content: space-between; margin-top: 1rem;">
    <h3>Open Orders</h3>

    <div id="gatewayCostSummary" style="font-size: 1rem; display: flex; align-items: center; gap: 1.5rem;">
      <div>
        <strong>Total Spent:</strong>
        $<span id="totalSpentGateway">0.00</span>
      </div>

      <!-- âœ… read-only counts fed by Firestore -->
      <div>
        <strong>Remaining Guests:</strong>
        <span id="gatewayRemainingGuests">0</span>
      </div>

      <div>
        <strong>Total Guests:</strong>
        <span id="gatewayTotalGuests">0</span>
      </div>

      <div>
        <strong>Cost per Guest:</strong>
        $<span id="costPerGuestGateway">0.00</span>
      </div>
    </div>
  </div>

  <table id="gatewayTable">
    <thead>
      <tr>
        <th>Time</th>
        <th>Due</th>
        <th>Item</th>
        <th>Qty</th>
        <th>Status</th>
        <th>Receive</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>



  <!-- âž‹ Starting Par -->
  <div class="gateway-section" data-sec="starting" style="display:none">
    <h3>Starting Par</h3>
    <p id="gatewayGuestInfo">Loading guest count...</p>

    <div class="order-controls">
      <label>
        Section:
        <select id="gateway-starting-category" onchange="renderStartingStatus('Gateway', startingCache['Gateway'])">
          <option value="">All</option>
          <option>Hotfoods</option>
          <option>Bakery</option>
          <option>Pantry</option>
        </select>
      </label>
    </div>
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Par Qty</th>
          <th>Sent Qty</th>
          <th>Receive</th>
        </tr>
      </thead>
      <tbody id="gatewayParTableBody"></tbody>
    </table>
  </div>

  <!-- âžŒ Waste -->
<div class="gateway-section" data-sec="waste" style="display:none">
  <h3>Gateway Waste</h3>

  <div class="order-controls">
    <label for="gateway-waste-category" style="margin-right: 12px;">
      Filter by Category:
      <select id="gateway-waste-category" onchange="filterGatewayWaste()">
        <option value="">All Categories</option>
        <option value="Hotfoods">Hotfoods</option>
        <option value="Bakery">Bakery</option>
        <option value="Pantry">Pantry</option>
        <!-- Add more categories if needed -->
      </select>
    </label>

    <label for="gatewayWasteSearch" style="margin-right: 12px;">
      Search:
      <input type="text" id="gatewayWasteSearch" placeholder="Search items..." oninput="filterGatewayWaste()" />
    </label>

    <button onclick="sendAllGatewayWaste()">Send All Waste</button>
  </div>

  <table class="waste-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>UOM</th>
        <th>Qty</th>
        <th>Send</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

  <!-- âž Returns -->
  <div class="gateway-section returns-section" data-sec="returns" style="display:none">
    <h3>Gateway Returns</h3>
    <table class="gateway-returns-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>Current</th>
          <th>Returned</th>
          <th>Return</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
</div>


 <div class="screen" id="concession">
  <div class="header-container">
    <h2>Concession</h2>
    <div class="area-tabs">
      <button class="area-tab" data-area="concession" data-sec="order" onclick="showAreaSection('concession','order')">Add-ons</button>
      <button class="area-tab" data-area="concession" data-sec="starting" onclick="showAreaSection('concession','starting')">Starting Par</button>
    </div>
    <button type="button" class="collapse-toggle" data-target="concession" aria-expanded="true" aria-label="Collapse section" title="Collapse section">-</button>
  </div>

  <div class="collapsible-content" data-screen="concession">
  <!-- Add-Ons Section -->
  <div class="concession-section" data-sec="order">
    <div class="order-controls">
     

      <select id="concessionItem">
        <option value="">-- Select Item --</option>
      </select>

      <input id="concessionQty" type="number" min="1" value="1" placeholder="Qty" />
      <input id="concessionNotes" type="text" placeholder="Notes (e.g. extra ice)" />
      <button onclick="sendConcessionOrder(this)">Send</button>
    </div>

    <h3>Open Orders</h3>
    <table id="concessionTable">
      <thead>
        <tr>
          <th>Time</th>
          <th>Due</th>
          <th>Item</th>
          <th>Qty</th>
          <th>Status</th>
          <th>Receive</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Starting Par Section -->
  <div class="concession-section" data-sec="starting" style="display:none">
    <h3>Starting Par</h3>
    <p id="concessionGuestInfo">Loading guest count...</p>

    <div class="order-controls">
      <label>
        Section:
        <select id="concession-starting-category" onchange="renderStartingStatus('Concession', startingCache['Concession'])">
          <option value="">All</option>
          <option>Hotfoods</option>
          <option>Bakery</option>
          <option>Pantry</option>
        </select>
      </label>
    </div>

    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Par Qty</th>
          <th>Sent Qty</th>
          <th>Receive</th>
        </tr>
      </thead>
      <tbody id="concessionParTableBody"></tbody>
    </table>
  </div>
</div>
</div>

<div id="main-kitchen" class="screen">
  <div class="header-container">
    <h2>Main Kitchen</h2>
    <button id="connectScaleBtn">Connect Scale</button>


    <!-- Tabs -->
    <div class="area-tabs">
      <button class="area-tab" data-area="mainkitchen" data-sec="order" onclick="showKitchenSection('order')">Add-Ons</button>
      <button class="area-tab" data-area="mainkitchen" data-sec="starting" onclick="showKitchenSection('starting')">Starting Pars</button>
      <button class="area-tab" data-area="mainkitchen" data-sec="prep"     onclick="showKitchenSection('prep')">Prep Pars</button>
      <button class="area-tab" data-area="mainkitchen" data-sec="transfer" onclick="showKitchenSection('transfer')">Inventory</button>
        <button class="area-tab" data-area="mainkitchen" data-sec="recipes" onclick="showKitchenSection('recipes')">Recipes</button>
      <button class="area-tab" data-area="mainkitchen" data-sec="waste" onclick="showKitchenSection('waste')">Waste</button>
      <button class="area-tab" data-area="mainkitchen" data-sec="returns" onclick="showKitchenSection('returns')">Returns</button>
      <button class="area-tab" data-area="mainkitchen" data-sec="lunch" onclick="showKitchenSection('lunch')">Lunch</button>
    </div>
    <button type="button" class="collapse-toggle" data-target="main-kitchen" aria-expanded="true" aria-label="Collapse section" title="Collapse section">-</button>
  </div>

  <div class="collapsible-content" data-screen="main-kitchen">
  <!-- ðŸ“¦ add on -->
  <div class="main-kitchen-section order-section" data-sec="order">
  <h3>Open Orders</h3>
<div id="mainKitchenNotif"></div>

  <!-- ðŸ” Search Bar -->
  <div style="margin-bottom: 1em;">
    <label for="kitchenSearchInput">
      Search Item:
      <input
        type="text"
        id="kitchenSearchInput"
        placeholder="Search by item name..."
        oninput="filterKitchenOrders()"
      />
    </label>
  </div>

  <!-- ðŸ“‹ Orders Table -->
  <div class="table-wrap table-wrap--addons">
    <table id="kitchenTable">
      <thead>
        <tr>
          <th>Due</th>
          <th>Area</th>
          <th>Item</th>
          <th>Qty</th>
          <th>Status</th>
          <th>Send Qty</th>
          <th>UOM</th>
          <th>Send</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="noteModal" class="note-modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="note-modal__backdrop" data-dismiss="note-modal"></div>
    <div class="note-modal__content" role="document">
      <div class="note-modal__header">
        <span>Item Note</span>
        <button type="button" class="note-modal__close" data-dismiss="note-modal">Close</button>
      </div>
      <div id="noteModalBody" class="note-modal__body"></div>
    </div>
  </div>
</div>

<!-- ðŸ¥„ Starting Pars Section -->
<div class="main-kitchen-section starting-section" data-sec="starting" style="display: none;">
  <h3>Starting Pars</h3>

  <!-- Controls bar the JS toggles via showKitchenSection() -->
  <div id="mainKitchenControls"
       class="order-controls"
       style="display:none;">

    <!-- Left: filters -->
    <div class="filter-controls" style="display:flex; flex-wrap:wrap; gap:12px; align-items:center;">
      <label>
        Venue:
        <select id="starting-filter-venue">
          <option value="">All</option>
          <option value="Aloha">Aloha</option>
          <option value="Ohana">Ohana</option>
          <option value="Gateway">Gateway</option>
          <option value="Concessions">Concessions</option>
        </select>
      </label>
      <label>
        Station:
        <select id="starting-filter-station">
          <option value="">All</option>
          <option value="Hotfoods">Hotfoods</option>
          <option value="Bakery">Bakery</option>
          <option value="Pantry">Pantry</option>
        </select>
      </label>
      <label>
        Item:
        <input id="starting-filter-item"
               type="search"
               placeholder="Search items"
               style="min-width:180px; padding:4px 8px;" />
      </label>
    </div>

    <!-- Right: Send All -->
    <div>
      <button id="mainKitchenSendAllBtn" class="send-all-btn" onclick="sendAllMainKitchenStartingPar()">Send All</button>
    </div>
  </div>

  <!-- Tiny legend (optional, no functional impact) -->
  <div style="font-size:12px; opacity:.8; margin:6px 0;">
    âœ… Green rows = completed or NA. You can still add more to completed rows unless marked NA.
  </div>

  <table id="startingParsTable">
    <thead>
      <tr>
        <th>Area</th>
        <th>Item</th>
        <th>Par Qty</th>
        <th>UOM</th>
        <th>Send / NA</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>


<!-- PREP PARS SECTION (hidden by default) -->
<div class="prep-section main-kitchen-section" data-sec="prep" style="display:none;">
  <div class="order-controls">
    <label>
      <span>Venue</span>
      <select id="prepVenueFilter" onchange="reloadMainKitchenPrepPars()">
        <option value="ALL">All Venues</option>
        <option value="Gateway">Gateway</option>
        <option value="Aloha">Aloha</option>
        <option value="Ohana">Ohana</option>
        <option value="Concessions">Concessions</option>
      </select>
    </label>

    <label>
      <span>Area</span>
      <select id="prepAreaFilter" onchange="reloadMainKitchenPrepPars()">
        <option value="ALL">All Areas</option>
        <option value="HOTFOODS">Hotfoods</option>
        <option value="PANTRY">Pantry</option>
        <option value="BAKERY">Bakery</option>
      </select>
    </label>
    <button type="button" id="resetLeftoversBtn" class="ghost-btn" onclick="resetPrepLeftovers()">Reset Leftovers</button>
  </div>

  <div class="table-wrap">
    <table id="prepParsTable" class="compact">
      <thead>
        <tr>
          <th>Venue</th>
          <th>Area</th>
          <th>Item</th>
          <th>Prep<br />Par</th>
          <th>Leftover</th>
          <th>Prepped<br />Today</th>
          <th>Available</th>
          <th>Need to<br />Prep</th>
          <th>Enter Pans<br />Made</th>
          <th>Save</th>
        </tr>
      </thead>
      <tbody id="prepParsTbody"></tbody>
    </table>
  </div>
</div>

<!-- Transfer Order Section -->
<div class="main-kitchen-section transfer-section" data-sec="transfer" style="display:none;">
  <div class="transfer-tabs-row">
    <div class="transfer-tabs" role="tablist">
      <button type="button" class="transfer-tab active" data-transfer-tab="order" aria-selected="true">Inventory</button>
      <button type="button" class="transfer-tab" data-transfer-tab="picklist" aria-selected="false">Current Order</button>
      <button type="button" class="transfer-tab" data-transfer-tab="eom" aria-selected="false">EOM</button>
    </div>
    <div class="transfer-actions">
      <button type="button" id="transferOrderSaveBtn" class="save-btn transfer-save-btn" hidden>Save Transfer Order</button>
      <button type="button" id="transferOrderResetBtn" class="ghost-btn transfer-reset-btn" hidden>Reset On-Hand</button>
    </div>
  </div>

  <div class="transfer-pane transfer-order-inventory" data-transfer-pane="order">
    <div class="table-wrap table-wrap--transfer" aria-label="Transfer order inventory table">
      <table id="transferOrderTable">
        <thead>
          <tr>
            <th>Item #</th>
            <th>Description</th>
            <th>On Hand</th>
            <th>Per CS</th>
            <th>Min</th>
            <th>Needed</th>
            <th>UOM</th>
          </tr>
        </thead>
        <tbody id="transferOrderTableBody">
          <tr>
            <td colspan="7" class="transfer-order-empty">Loading transfer itemsâ€¦</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="transfer-pane transfer-order-eom" data-transfer-pane="eom" hidden>
    <section class="transfer-eom" aria-labelledby="transferEomHeading">
      <div class="transfer-eom__header">
        <div class="transfer-eom__title">
          <h4 id="transferEomHeading">EOM</h4>
          <span id="transferEomStatus" class="transfer-eom-status" role="status" aria-live="polite"></span>
        </div>
        <div class="transfer-eom__actions">
          <button type="button" id="transferEomSaveBtn" class="save-btn">Save EOM</button>
          <button type="button" id="transferEomAddRowBtn" class="ghost-btn">Add Line</button>
          <button type="button" id="transferEomResetBtn" class="ghost-btn">Reset EOM</button>
        </div>
      </div>
      <div class="table-wrap table-wrap--transfer-eom">
        <table id="transferEomTable">
          <thead>
            <tr>
              <th>Description</th>
              <th>Qty</th>
              <th>UOM</th>
            </tr>
          </thead>
          <tbody id="transferEomTableBody">
            <tr>
              <td colspan="3" class="transfer-eom-empty">Add items to build your EOM list.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <div class="transfer-pane transfer-order-picklist" data-transfer-pane="picklist" hidden>
    <div class="transfer-order-panel">
      <div class="transfer-order-panel-header">
        <h4>Your Current Order</h4>
        <div class="transfer-order-panel-actions">
          <span id="transferOrderPickSummary" class="transfer-order-count">0 items</span>
          <button type="button" id="transferOrderCopyBtn" class="ghost-btn transfer-copy-btn" disabled>Copy List</button>
        </div>
      </div>
      <div class="table-wrap table-wrap--transfer-picklist">
        <table id="transferOrderPickTable">
          <thead>
            <tr>
              <th>Item #</th>
              <th>Description</th>
              <th>Needed</th>
              <th>UOM</th>
            </tr>
          </thead>
          <tbody id="transferOrderPickBody">
            <tr>
              <td colspan="4" class="transfer-order-empty">Nothing needed right now.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<datalist id="transferEomRecipeOptions"></datalist>

<!-- ===================== Main Kitchen â–¸ Recipes ===================== -->
<div class="main-kitchen-section recipes-section" data-sec="recipes" style="display:none;">
  <div class="order-controls">
    <input id="recipeSearch" type="text" placeholder="Search recipes by name or numberâ€¦" oninput="renderRecipesList()" />
    <select id="recipeCategoryFilter" onchange="renderRecipesList()">
      <option value="">All Categories</option>
      <option value="HOTFOODS">HOTFOODS</option>
      <option value="PANTRY">PANTRY</option>
      <option value="BAKERY">BAKERY</option>
    </select>
    <button type="button" onclick="openAddRecipeDialog()">Add Recipe</button>
  </div>


  <!-- List of recipes -->
  <div id="recipesList"></div>

  <!-- Add / Configure Recipe dialog -->
  <!-- Add / Configure Recipe dialog -->
<dialog id="addRecipeDialog">
  <form method="dialog" autocomplete="off">
    <h3 style="margin:0 0 .5rem 0;">Add / Configure Recipe</h3>

    <label style="display:block; margin: .5rem 0;">
      Choose base recipe
      <select id="recipeSelect">
        <option value="">-- Select recipe from Firestore --</option>
      </select>
    </label>

    <div style="margin: .5rem 0;">
      <div class="order-controls" style="margin:0">
        <span>Ingredients</span>
        <button type="button" onclick="addRecipeLine()">+ Add line</button>
      </div>
      <div id="recipeLines"></div>
    </div>

    <label style="display:block; margin: .5rem 0;">
      Base Portions (yield)
      <input id="recipePortions" type="number" min="1" step="1" placeholder="e.g., 24" />
    </label>

    <label style="display:block; margin: .5rem 0;">
      Methodology / Steps
      <textarea id="recipeMethodology" rows="6" placeholder="Step 1:
Step 2:
Step 3: â€¦"></textarea>
    </label>

    <div class="dialog-actions">
      <button type="button" class="cancel-btn" onclick="closeAddRecipeDialog()">Cancel</button>
      <button type="button" class="save-btn" onclick="saveRecipeConfig()">Save Recipe</button>
    </div>
  </form>
</dialog>

</div>



  <!-- â™»ï¸ Waste Section -->
  <div class="main-kitchen-section waste-section" data-sec="waste" style="display:none">
    <h3>Main Kitchen Waste</h3>
    <div style="margin-bottom: 10px;">
      <input id="mainWasteSearch" type="text" placeholder="Search item..." oninput="filterMainWaste()" style="margin-right: 10px; padding: 4px;" />
      <select id="mainWasteCategory" onchange="filterMainWaste()" style="padding: 4px;">
        <option value="">All Categories</option>
        <option value="bakery">Bakery</option>
        <option value="hotfoods">Hotfoods</option>
        <option value="pantry">Pantry</option>
        <option value="ingredients">Ingredients</option>
      </select>
      <button onclick="sendAllMainWaste()" style="margin-left: 12px;">Send All Waste</button>
    </div>
    <table class="main-waste-table">
      <thead>
        <tr>
          <th>Item</th>
          <th>UOM</th>
          <th>Qty</th>
          <th>Send</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<!-- ðŸ” Returns Section -->
<div class="main-kitchen-section returns-section" data-sec="returns" style="display: none;">
  <h3>Main Kitchen Returns</h3>
  <div style="margin-bottom: 10px;">
    <label>
      Filter by Venue:
      <select id="mainReturnsVenueFilter" onchange="filterMainKitchenReturns()" style="padding: 4px;">
        <option value="">All Venues</option>
        <option value="Aloha">Aloha</option>
        <option value="Ohana">Ohana</option>
        <option value="Gateway">Gateway</option>
        <option value="Concession">Concession</option>
      </select>
    </label>
    <!-- âœ… Receive All button -->
    <button id="receiveAllMainReturns" onclick="receiveAllMainReturns()" disabled style="margin-left: 10px;">
      Receive All
    </button>
  </div>
  <table class="main-returns-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>Venue</th>
        <th>Qty</th>
        <th>Receive</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

  <!-- ðŸ¥— Lunch Section -->
  <div class="main-kitchen-section lunch-section" data-sec="lunch" style="display: none;">
    <h3>Main Kitchen Lunch</h3>
    <div style="margin-bottom: 10px;">
      <input id="mainLunchSearch" type="text" placeholder="Search item..." oninput="filterMainLunch()" style="margin-right: 10px; padding: 4px;" />
      <select id="mainLunchCategory" onchange="filterMainLunch()" style="padding: 4px;">
        <option value="">All Categories</option>
        <option value="bakery">Bakery</option>
        <option value="hotfoods">Hotfoods</option>
        <option value="pantry">Pantry</option>
        <option value="ingredients">Ingredients</option>
      </select>
      <button onclick="sendAllMainLunch()" style="margin-left: 12px;">Send All Lunch</button>
    </div>
  <table class="main-lunch-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>UOM</th>
        <th>Qty</th>
        <th>Send</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  </div>
</div>


</div>


<div class="screen" id="stations">
  <div class="header-container header-container--simple">
    <h2>Stations</h2>

    <!-- Navigation Tabs -->
    <div class="station-tabs">
      <button onclick="showStationTab('Wok')">Wok</button>
      <button onclick="showStationTab('Fryer')">Fryer</button>
      <button onclick="showStationTab('Grill')">Grill</button>
      <button onclick="showStationTab('Oven')">Oven</button>
      <button onclick="showStationTab('Pantry')">Pantry</button>
      <button onclick="showStationTab('Pastry')">Pastry</button>
    </div>
    <button type="button" class="collapse-toggle" data-target="stations" aria-expanded="true" aria-label="Collapse section" title="Collapse section">-</button>
  </div>

  <div class="collapsible-content" data-screen="stations">
  <!-- Station Tables -->

  <!-- Wok Section -->
  <div id="WokSection" class="station-section">
  <h3>Wok Station</h3>

  
  <table id="WokTable">
    <thead>
      <tr>
        <th>Time</th>
        <th>Due</th>
        <th>Area</th>
        <th>Item</th>
        <th>Notes</th>
        <th>Qty</th>
        <th>Send Qty</th>
        <th>UOM</th>
        <th>Send</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Fryer Section -->
<div id="FryerSection" class="station-section" style="display:none">
  <h3>Fryer Station</h3>
  <table id="FryerTable">
    <thead>
      <tr><th>Time</th><th>Due</th><th>Area</th><th>Item</th><th>Qty</th><th>Notes</th><th>Complete</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Grill Section -->
<div id="GrillSection" class="station-section" style="display:none">
  <h3>Grill Station</h3>


  <table id="GrillTable">
    <thead>
      <tr>
        <th>Time</th>
        <th>Due</th>
        <th>Area</th>
        <th>Item</th>
        <th>Notes</th>
        <th>Qty</th>
        <th>Send Qty</th>
        <th>UOM</th>
        <th>Send</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Oven Section -->
<div id="OvenSection" class="station-section" style="display:none">
  <h3>Oven Station</h3>
  <table id="OvenTable">
    <thead>
      <tr><th>Time</th><th>Due</th><th>Area</th><th>Item</th><th>Qty</th><th>Notes</th><th>Complete</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Pantry Section -->
<div id="PantrySection" class="station-section" style="display:none">
  <h3>Pantry Station</h3>
  <table id="PantryTable">
    <thead>
      <tr><th>Time</th><th>Due</th><th>Area</th><th>Item</th><th>Qty</th><th>Notes</th><th>Complete</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Pastry Section -->
<div id="PastrySection" class="station-section" style="display:none">
  <h3>Pastry Station</h3>
  <table id="PastryTable">
    <thead>
      <tr><th>Time</th><th>Due</th><th>Area</th><th>Item</th><th>Qty</th><th>Notes</th><th>Complete</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
  </div>

</div>

<!-- ðŸ” Accounting screen with passcode protection -->
<div class="screen" id="accounting" style="display:none;">
  <div id="accounting-lock">
    <h2>Enter Passcode</h2>
    <input type="password" id="accountingPass" placeholder="Enter code" />
    <button onclick="unlockAccounting()">Unlock</button>
  </div>

  <div id="accounting-content" style="display:none;">
    <div class="area-tabs">
      <button type="button" class="area-tab accounting-group-btn" data-group="meal-plan" onclick="showAccountingGroup('meal-plan')">Meal Plan</button>
      <button type="button" class="area-tab accounting-group-btn" data-group="data" onclick="showAccountingGroup('data')">Data</button>
      <button type="button" class="area-tab accounting-group-btn" data-group="items" onclick="showAccountingGroup('items')">Items</button>
    </div>

    <div class="accounting-subtabs-wrapper">
      <div class="accounting-subtabs" data-group="meal-plan">
        <button type="button" class="accounting-subtab" data-accounting-tab="production" onclick="showAccountingTab('production')">Production</button>
        <button type="button" class="accounting-subtab" data-accounting-tab="shipments" onclick="showAccountingTab('shipments'); loadProductionShipments([]);">Production Shipments</button>
        <button type="button" class="accounting-subtab" data-accounting-tab="waste" onclick="showAccountingTab('waste')">Waste</button>
        <button type="button" class="accounting-subtab" data-accounting-tab="lunch" onclick="showAccountingTab('lunch')">Lunch</button>
        <button type="button" class="accounting-subtab" data-accounting-tab="kitchen-eom" onclick="showAccountingTab('kitchen-eom')">Kitchen EOM</button>
      </div>
      <div class="accounting-subtabs" data-group="data" hidden>
        <button type="button" class="accounting-subtab" data-accounting-tab="analytics" onclick="showAccountingTab('analytics'); showAccountingDashboard();">Analytics</button>
        <button type="button" class="accounting-subtab" data-accounting-tab="ls-recipes" onclick="showAccountingTab('ls-recipes'); ensureAccountingLsRecipesUI();">LS Recipes</button>
      </div>
      <div class="accounting-subtabs" data-group="items" hidden>
        <button type="button" class="accounting-subtab" data-accounting-tab="ingredients" onclick="showAccountingTab('ingredients')">Ingredients</button>
        <button type="button" class="accounting-subtab" data-accounting-tab="uom" onclick="showAccountingTab('uom')">UOM</button>
        <button type="button" class="accounting-subtab" data-accounting-tab="recipes" onclick="showAccountingTab('recipes')">Recipes &amp; Pars</button>
      </div>
    </div>

    <!-- Production Section -->
    <div id="productionSection" class="accounting-section" data-sec="production">
      <h3>Production Summary</h3>
      <button onclick="copyProductionSummaryToClipboard()">Copy to Excel</button>
      <table id="productionTable">
        <thead>
          <tr>
            <th>Submenu Code</th>
            <th>Dish Code</th>
            <th>Recipe No.</th>
            <th>Recipe Description</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Shipments Section -->
    <div id="shipmentsTab" class="accounting-section" data-sec="shipments" style="display:none;">
      <h3>Production Shipments</h3>
      <div class="venue-tabs">
        <button onclick="loadVenueShipment('b001')">Aloha</button>
        <button onclick="loadVenueShipment('b002')">Ohana</button>
        <button onclick="loadVenueShipment('b003')">Gateway</button>
        <button onclick="loadVenueShipment('c002')">Samoa Concessions</button>
        <button onclick="loadVenueShipment('c003')">Maori Concessions</button>
        <!--<button onclick="loadVenueShipment('c004')">Tongan Concessions</button> -->
      </div>
      <div id="singleVenueShipmentContainer"></div>
    </div>

    <!-- Waste Section -->
    <div id="wasteTab" class="accounting-section" data-sec="waste" style="display:none;">
      <h3>WASTE COMPILE</h3>
      <button onclick="copyWasteTableToClipboard()">Copy to Excel</button>
      <table id="wasteTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Recipe No.</th>
            <th>Recipe Description</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Lunch Section -->
    <div id="lunchTab" class="accounting-section" data-sec="lunch" style="display:none;">
      <h3>LUNCH RECORDS</h3>
      <button onclick="copyLunchTableToClipboard()">Copy to Excel</button>
      <table id="lunchTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Item No.</th>
            <th>Item</th>
            <th>Qty</th>
            <th>UOM</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Kitchen EOM Section -->
    <div id="kitchenEomTab" class="accounting-section accounting-section--table" data-sec="kitchen-eom" style="display:none;">
      <div class="accounting-shell">
        <div class="accounting-controls" role="toolbar">
          <div class="accounting-controls__info">
            <h3 class="accounting-controls__title">Kitchen EOM</h3>
            <p class="accounting-controls__hint">Paste item list to total inventory plus EOM counts.</p>
          </div>
          <div class="accounting-controls__actions">
            <button type="button" class="ghost-btn" id="kitchenEomClearBtn">Clear</button>
            <button type="button" class="save-btn" id="kitchenEomRefreshBtn">Refresh Totals</button>
          </div>
        </div>
        <div class="kitchen-eom-input">
          <label for="kitchenEomPasteArea" class="accounting-search-label">Item No. and Description</label>
          <textarea id="kitchenEomPasteArea" rows="4" placeholder="Item No.&#9;Description&#10;5001&#9;SUGAR GRANULATED"></textarea>
          <button type="button" id="kitchenEomApplyBtn" class="ghost-btn">Update Table</button>
        </div>
        <p id="kitchenEomStatus" role="status" aria-live="polite"></p>
        <div class="table-wrap accounting-table">
          <table id="kitchenEomTable">
            <thead>
              <tr>
                <th scope="col">Item No.</th>
                <th scope="col">Description</th>
                <th scope="col">Total</th>
                <th scope="col">UOM</th>
              </tr>
            </thead>
            <tbody id="kitchenEomTbody"></tbody>
          </table>
        </div>
        <p id="kitchenEomEmpty" class="accounting-empty">Paste item list above to begin.</p>
      </div>
    </div>

    <!-- LS Recipes Section -->
    <div id="lsRecipesTab" class="accounting-section" data-sec="ls-recipes" style="display:none;">
      <div class="accounting-section__header">
        <h3>LS Recipes</h3>
        <span id="lsRecipesLoading" class="accounting-loader" hidden>Loadingâ€¦</span>
      </div>
      <div class="accounting-controls">
        <div class="accounting-controls__group">
          <label for="lsRecipesDate" class="accounting-search-label">
            Service Date
          </label>
          <input type="date" id="lsRecipesDate" />
        </div>
        <div class="accounting-controls__group">
          <label for="lsRecipesSearch" class="accounting-search-label">
            Search Description
          </label>
          <input type="search" id="lsRecipesSearch" placeholder="Type to filter ingredientsâ€¦" autocomplete="off" />
        </div>
        <button type="button" id="lsRecipesCopy" class="ls-copy-btn">Copy Table</button>
      </div>
      <div class="table-wrapper">
        <table id="lsRecipesTable" class="accounting-table">
          <thead>
            <tr>
              <th>
                <span class="ls-header">
                  <span class="ls-header__label">Parent No</span>
                  <span class="ls-header__sort">
                    <button type="button" class="ls-sort-btn" data-column="parentNo" data-direction="asc" aria-label="Sort Parent No ascending">â–²</button>
                    <button type="button" class="ls-sort-btn" data-column="parentNo" data-direction="desc" aria-label="Sort Parent No descending">â–¼</button>
                  </span>
                </span>
              </th>
              <th>
                <span class="ls-header">
                  <span class="ls-header__label">Parent Name</span>
                  <span class="ls-header__sort">
                    <button type="button" class="ls-sort-btn" data-column="parentName" data-direction="asc" aria-label="Sort Parent Name ascending">â–²</button>
                    <button type="button" class="ls-sort-btn" data-column="parentName" data-direction="desc" aria-label="Sort Parent Name descending">â–¼</button>
                  </span>
                </span>
              </th>
              <th>
                <span class="ls-header">
                  <span class="ls-header__label">Ingredient No</span>
                  <span class="ls-header__sort">
                    <button type="button" class="ls-sort-btn" data-column="ingredientNo" data-direction="asc" aria-label="Sort Ingredient No ascending">â–²</button>
                    <button type="button" class="ls-sort-btn" data-column="ingredientNo" data-direction="desc" aria-label="Sort Ingredient No descending">â–¼</button>
                  </span>
                </span>
              </th>
              <th>
                <span class="ls-header">
                  <span class="ls-header__label">Description</span>
                  <span class="ls-header__sort">
                    <button type="button" class="ls-sort-btn" data-column="description" data-direction="asc" aria-label="Sort Description ascending">â–²</button>
                    <button type="button" class="ls-sort-btn" data-column="description" data-direction="desc" aria-label="Sort Description descending">â–¼</button>
                  </span>
                </span>
              </th>
              <th>
                <span class="ls-header">
                  <span class="ls-header__label">Total Qty</span>
                  <span class="ls-header__sort">
                    <button type="button" class="ls-sort-btn" data-column="totalQty" data-direction="asc" aria-label="Sort Total Qty ascending">â–²</button>
                    <button type="button" class="ls-sort-btn" data-column="totalQty" data-direction="desc" aria-label="Sort Total Qty descending">â–¼</button>
                  </span>
                </span>
              </th>
              <th>
                <span class="ls-header">
                  <span class="ls-header__label">Recipe Qty</span>
                  <span class="ls-header__sort">
                    <button type="button" class="ls-sort-btn" data-column="recipeQty" data-direction="asc" aria-label="Sort Recipe Qty ascending">â–²</button>
                    <button type="button" class="ls-sort-btn" data-column="recipeQty" data-direction="desc" aria-label="Sort Recipe Qty descending">â–¼</button>
                  </span>
                </span>
              </th>
              <th>
                <span class="ls-header">
                  <span class="ls-header__label">Amount Used</span>
                  <span class="ls-header__sort">
                    <button type="button" class="ls-sort-btn" data-column="amountUsed" data-direction="asc" aria-label="Sort Amount Used ascending">â–²</button>
                    <button type="button" class="ls-sort-btn" data-column="amountUsed" data-direction="desc" aria-label="Sort Amount Used descending">â–¼</button>
                  </span>
                </span>
              </th>
              <th>
                <span class="ls-header">
                  <span class="ls-header__label">UOM</span>
                  <span class="ls-header__sort">
                    <button type="button" class="ls-sort-btn" data-column="uom" data-direction="asc" aria-label="Sort UOM ascending">â–²</button>
                    <button type="button" class="ls-sort-btn" data-column="uom" data-direction="desc" aria-label="Sort UOM descending">â–¼</button>
                  </span>
                </span>
              </th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <p id="lsRecipesEmpty" hidden>No recipes match your filters.</p>
      </div>
    </div>

    <!-- Analytics Section -->
<div id="analyticsTab" class="accounting-section" data-sec="analytics" style="display:none;">
  <section class="analytics" id="analyticsDashboard" style="margin-top:1rem;">

    <!-- Filters (top row) -->
    <div class="filters" style="display:flex; gap:12px; flex-wrap:wrap; align-items:end;">
      <div>
        <label for="fStart">Start</label><br/>
        <input type="date" id="fStart">
      </div>
      <div>
        <label for="fEnd">End</label><br/>
        <input type="date" id="fEnd">
      </div>
      <div>
        <label for="fVenue">Venue</label><br/>
        <select id="fVenue">
          <option value="All">All</option>
          <option value="Aloha">Aloha</option>
          <option value="Ohana">Ohana</option>
          <option value="Gateway">Gateway</option>
          <option value="Concessions">Concessions</option>
          <option value="Main Kitchen">Main Kitchen</option>
        </select>
      </div>
      <div>
        <label for="fSection">Section</label><br/>
        <select id="fSection">
          <option value="All">All</option>
        </select>
      </div>

      <button id="applyAnalyticsFilters">Apply Filters</button>
      <span id="analyticsLoading" style="display:none;">â³ loadingâ€¦</span>

      <div style="margin-left:auto; display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
        <div id="analytics-nav" style="display:flex; gap:6px;">
          <button class="an-tab active" data-analytics="cogs">Food Item COGS</button>
          <button class="an-tab" data-analytics="timing">Food Timing</button>
          <button class="an-tab" data-analytics="qty-per-guest">Qty per Guest</button>
          <button class="an-tab" data-analytics="pan-weight">Pan Weight</button>
        </div>
        <button type="button" id="copyAnalyticsTableBtn" class="ghost-btn" style="padding:6px 12px;">Copy Table</button>
        <span id="copyAnalyticsStatus" role="status" aria-live="polite" style="display:none; font-size:0.85rem; color:#9ca3af;"></span>
      </div>
    </div>

    <!-- Main layout: table left, side panel right -->
    <div style="display:grid; grid-template-columns: 2fr 1fr; gap:16px; margin-top:12px;">

      <!-- LEFT: Tables -->
      <div class="card" style="padding:12px; border:1px solid #333; border-radius:12px; overflow:auto;">

        <!-- COGS TAB -->
        <div class="analytics-section" data-analytics="cogs" style="display:block;">
          <h3 style="margin:0 0 8px;">Food Item COGS</h3>
          <table id="foodCogsTable" style="width:100%; border-collapse:collapse;">
            <thead>
              <tr style="text-align:left; border-bottom:1px solid #444;">
                <th>Date</th>
                <th>Venue</th>
                <th>Item</th>
                <th>Recipe #</th>
                <th>Qty</th>
                <th>UOM</th>
                <th style="text-align:right;">Cost</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr style="border-top:1px solid #444;">
                <td colspan="6" style="text-align:right;"><strong>Total</strong></td>
                <td id="analyticsTableTotal" style="text-align:right;">$0.00</td>
              </tr>
            </tfoot>
          </table>
        </div>

        <!-- TIMING TAB -->
        <div class="analytics-section" data-analytics="timing" style="display:none;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin:0 0 8px;">
            <h3 style="margin:0;">Food Timing (Add-ons)</h3>
            <div id="timingOutlierControls" style="display:flex; gap:6px; align-items:center; font-size:12px;">
              <span style="opacity:.7;">Outliers</span>
              <button type="button" class="timing-outlier-btn active" data-mode="all">Keep All</button>
              <button type="button" class="timing-outlier-btn" data-mode="std1">Â±1Ïƒ</button>
              <button type="button" class="timing-outlier-btn" data-mode="std2">Â±2Ïƒ</button>
            </div>
            <button type="button" id="copyTimingTableBtn" style="font-size:12px; padding:6px 10px; border-radius:8px; border:1px solid #555; background:#2b2d36; color:#f5f5f5;">Copy Table</button>
          </div>
          <table id="foodTimingTable" style="width:100%; border-collapse:collapse;">
            <thead>
              <tr style="text-align:left; border-bottom:1px solid #444;">
                <th>Item</th>
                <th>Recipe #</th>
                <th>Venue</th>
                <th>Avg Orderâ†’Ready (min)</th>
                <th>Avg Readyâ†’Sent (min)</th>
                <th>Avg Sentâ†’Received (min)</th>
                <th>Avg Total (min)</th>
                <th>Samples</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- QTY / GUEST TAB -->
        <div class="analytics-section" data-analytics="qty-per-guest" style="display:none;">
          <h3 style="margin:0 0 8px;">Qty per Guest</h3>
          <table id="qtyPerGuestTable" style="width:100%; border-collapse:collapse;">
            <thead>
              <tr style="text-align:left; border-bottom:1px solid #444;">
                <th>Date</th>
                <th>Venue</th>
                <th>Item</th>
                <th>Recipe #</th>
                <th>Qty</th>
                <th>Guests</th>
                <th>Qty / Guest</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <h4 style="margin:16px 0 8px;">Averages Across Range (by Item)</h4>
          <table id="qtyPerGuestAverages" style="width:100%; border-collapse:collapse;">
            <thead>
              <tr style="text-align:left; border-bottom:1px solid #444;">
                <th>Item</th>
                <th>Recipe #</th>
                <th>Avg Qty / Guest</th>
                <th>Samples</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- PAN WEIGHT TAB -->
        <div class="analytics-section" data-analytics="pan-weight" style="display:none;">
          <h3 style="margin:0 0 8px;">Pan Weight &amp; Price</h3>
          <table id="panWeightTable" style="width:100%; border-collapse:collapse;">
            <thead>
              <tr style="text-align:left; border-bottom:1px solid #444;">
                <th>Recipe</th>
                <th>Recipe #</th>
                <th>Venues</th>
                <th>Total Pans</th>
                <th>Total Net Wt (lb)</th>
                <th>Avg Wt / Pan (lb)</th>
                <th>Cost / lb</th>
                <th>Price / Pan</th>
                <th>Records</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

      </div>

      <!-- RIGHT: side cards (COGS tab only) -->
      <div style="display:flex; flex-direction:column; gap:16px;">
        <!-- Date Range -->
        <div class="card side-cogs-only" style="padding:12px; border:1px solid #333; border-radius:12px;">
          <h3 style="margin:0 0 8px;">Date Range</h3>
          <div>From: <span id="drFrom"></span></div>
          <div>To:&nbsp;&nbsp;&nbsp; <span id="drTo"></span></div>
        </div>

        <!-- Category breakdown -->
        <div class="card side-cogs-only" style="padding:12px; border:1px solid #333; border-radius:12px;">
          <h3 style="margin:0 0 8px;">Item Category Breakdown</h3>
          <table id="categoryBreakdown" style="width:100%; border-collapse:collapse;">
            <tbody><!-- JS fills rows: Category | Cost + Total row --></tbody>
          </table>
        </div>

        <!-- Category multi-select -->
        <div class="card side-cogs-only" style="padding:12px; border:1px solid #333; border-radius:12px;">
          <h3 style="margin:0 0 8px;">Item Category</h3>
          <div id="filterCatWrap" style="display:flex; flex-wrap:wrap; gap:10px;">
            <!-- JS injects checkboxes -->
          </div>
        </div>

        <!-- Item search/multi-select -->
        <div class="card side-cogs-only" style="padding:12px; border:1px solid #333; border-radius:12px;">
          <h3 style="margin:0 8px 8px 0;">Item Description</h3>
          <input id="filterItemSearch" placeholder="Search itemsâ€¦" style="width:100%; margin-bottom:8px;">
          <div id="filterItemWrap" style="max-height:180px; overflow:auto;">
            <!-- JS injects checkboxes (recipeNo â€” description) -->
          </div>
        </div>
      </div>
    </div>

    <!-- Chart (COGS tab only) -->
    <div class="card side-cogs-only" style="padding:12px; border:1px solid #333; border-radius:12px; margin-top:16px;">
      <h3 style="margin:0 0 8px;">Cost per Category per Day</h3>
      <canvas id="categoryLineChart" height="220"></canvas>
    </div>

  </section>
</div>

<!-- [ACCOUNTING] START ingredients -->
    <div id="accountingIngredientsTab" class="accounting-section accounting-section--table" data-sec="ingredients" style="display:none;">
      <div class="accounting-shell">
        <div class="accounting-controls" role="toolbar">
          <div class="accounting-controls__info">
            <h3 class="accounting-controls__title">Ingredients</h3>
            <p class="accounting-controls__hint">Manage purchasing units and minimums.</p>
          </div>
          <div class="accounting-controls__actions">
            <button type="button" class="ghost-btn" id="accountingIngredientsRefresh">Refresh</button>
            <button type="button" class="save-btn" id="accountingIngredientsAdd">Add</button>
            <label class="accounting-controls__search">
              <span class="visually-hidden">Search ingredients</span>
              <input type="search" id="accountingIngredientsSearch" placeholder="Search ingredientsâ€¦" autocomplete="off" />
            </label>
          </div>
        </div>
        <div class="table-wrap accounting-table">
          <table id="accountingIngredientsTable">
            <colgroup>
              <col class="col-ing-itemno" />
              <col class="col-ing-name" />
              <col class="col-ing-base" />
              <col class="col-ing-order" />
              <col class="col-ing-number" />
              <col class="col-ing-number" />
              <col class="col-ing-number" />
              <col class="col-ing-number" />
              <col class="col-ing-number" />
              <col class="col-ing-actions" />
            </colgroup>
            <thead>
              <tr>
                <th scope="col">Item No.</th>
                <th scope="col">Item Name</th>
                <th scope="col">Base UOM</th>
                <th scope="col">Ordering UOM</th>
                <th scope="col">Shelf</th>
                <th scope="col">Row</th>
                <th scope="col">Min</th>
                <th scope="col">Amount / CS</th>
                <th scope="col">Base UOM / CS</th>
                <th scope="col" class="actions-header">Actions</th>
              </tr>
            </thead>
            <tbody id="accountingIngredientsTbody"></tbody>
          </table>
        </div>
        <p id="accountingIngredientsEmpty" class="accounting-empty" hidden>No matches found.</p>
      </div>
    </div>
    <!-- [ACCOUNTING] END ingredients -->

    <!-- [ACCOUNTING] START uom -->
    <div id="accountingUomTab" class="accounting-section accounting-section--table" data-sec="uom" style="display:none;">
      <div class="accounting-shell">
        <div class="accounting-controls" role="toolbar">
          <div class="accounting-controls__info">
            <h3 class="accounting-controls__title">Units of Measure</h3>
            <p class="accounting-controls__hint">Maintain UOM codes and quantities.</p>
          </div>
          <div class="accounting-controls__actions">
            <button type="button" class="ghost-btn" id="accountingUomRefresh">Refresh</button>
            <button type="button" class="save-btn" id="accountingUomAdd">Add</button>
            <label class="accounting-controls__search">
              <span class="visually-hidden">Search UOM</span>
              <input type="search" id="accountingUomSearch" placeholder="Search UOMâ€¦" autocomplete="off" />
            </label>
          </div>
        </div>
        <div class="table-wrap accounting-table">
          <table id="accountingUomTable">
            <colgroup>
              <col class="col-ing-itemno" />
              <col class="col-ing-name" />
              <col class="col-ing-name" />
              <col class="col-ing-number" />
              <col class="col-ing-actions" />
            </colgroup>
            <thead>
              <tr>
                <th scope="col">Item No.</th>
                <th scope="col">Item Name</th>
                <th scope="col">UOM</th>
                <th scope="col">Qty / UOM</th>
                <th scope="col" class="actions-header">Actions</th>
              </tr>
            </thead>
            <tbody id="accountingUomTbody"></tbody>
          </table>
        </div>
        <p id="accountingUomEmpty" class="accounting-empty" hidden>No UOM records found.</p>
      </div>
    </div>
    <!-- [ACCOUNTING] END uom -->

    <!-- [ACCOUNTING] START recipes -->
    <div id="accountingRecipesTab" class="accounting-section accounting-section--table" data-sec="recipes" style="display:none;">
      <div class="accounting-shell">
        <div class="accounting-controls" role="toolbar">
          <div class="accounting-controls__info">
            <h3 class="accounting-controls__title">Recipes &amp; Pars</h3>
            <div class="accounting-controls__view-toggle" role="tablist" aria-label="Recipe view toggle">
              <button type="button" class="accounting-subtab accounting-subtab--active" data-view="info">Recipe Info</button>
              <button type="button" class="accounting-subtab" data-view="pars">Recipe Pars</button>
            </div>
        </div>
          <div class="accounting-controls__actions">
            <button type="button" class="ghost-btn" id="accountingRecipesRefresh">Refresh</button>
            <button type="button" class="save-btn" id="accountingRecipeAddToggle" aria-expanded="false">Add Recipe</button>
            <label class="accounting-controls__search">
              <span class="visually-hidden">Search recipes</span>
              <input type="search" id="accountingRecipesSearch" placeholder="Search recipesâ€¦" autocomplete="off" />
            </label>
          </div>
        </div>

        <div class="accounting-venue-tabs" id="accountingRecipesVenueTabs" role="tablist" hidden>
          <button type="button" class="accounting-venue-tab accounting-venue-tab--active" data-venue="Aloha">Aloha</button>
          <button type="button" class="accounting-venue-tab" data-venue="Ohana">Ohana</button>
          <button type="button" class="accounting-venue-tab" data-venue="Gateway">Gateway</button>
          <button type="button" class="accounting-venue-tab" data-venue="Concessions">Concessions</button>
        </div>

        <form id="accountingRecipeAddForm" class="accounting-add-form" autocomplete="off" hidden>
          <fieldset class="accounting-add-fieldset">
            <legend class="accounting-add-legend">Add New Recipe</legend>
            <div class="accounting-add-grid">
              <label class="accounting-add-field">
                <span>Recipe No.</span>
                <input type="text" name="recipeNo" required placeholder="e.g. R0002" />
              </label>
              <label class="accounting-add-field accounting-add-field--wide">
                <span>Description</span>
                <input type="text" name="description" required placeholder="Recipe description" />
              </label>
              <label class="accounting-add-field">
                <span>UOM</span>
                <select name="uomSelect" required>
                  <option value="" data-placeholder="1" disabled selected>Select UOM</option>
                  <option value="EA">EA</option>
                  <option value="LB">LB</option>
                  <option value="__other__">Other</option>
                </select>
                <input type="text" name="uomOther" class="accounting-add-other" placeholder="Custom UOM" hidden disabled />
              </label>
              <label class="accounting-add-field">
                <span>Category</span>
                <select name="categorySelect" required>
                  <option value="" data-placeholder="1" disabled selected>Select Category</option>
                  <option value="__other__">Other</option>
                </select>
                <input type="text" name="categoryOther" class="accounting-add-other" placeholder="Custom Category" hidden disabled />
              </label>
              <label class="accounting-add-field">
                <span>Station</span>
                <select name="stationSelect" required>
                  <option value="" data-placeholder="1" disabled selected>Select Station</option>
                  <option value="__other__">Other</option>
                </select>
                <input type="text" name="stationOther" class="accounting-add-other" placeholder="Custom Station" hidden disabled />
              </label>
              <label class="accounting-add-field">
                <span>Pan Weight</span>
                <input type="number" step="0.01" min="0" name="panWeight" required placeholder="lbs" />
              </label>
              <label class="accounting-add-field">
                <span>Returns</span>
                <select name="returns" required>
                  <option value="" data-placeholder="1" disabled selected>Select</option>
                  <option value="YES">Yes</option>
                  <option value="NO">No</option>
                </select>
              </label>
              <label class="accounting-add-field">
                <span>Cook Time (min)</span>
                <input type="number" step="0.01" min="0" name="cookTime" required placeholder="Minutes" />
              </label>
            </div>

            <div class="accounting-add-venues">
              <details class="accounting-add-venue" data-venue="Aloha">
                <summary>Aloha</summary>
                <div class="accounting-add-venue__body"></div>
              </details>
              <details class="accounting-add-venue" data-venue="Ohana">
                <summary>Ohana</summary>
                <div class="accounting-add-venue__body"></div>
              </details>
              <details class="accounting-add-venue" data-venue="Gateway">
                <summary>Gateway</summary>
                <div class="accounting-add-venue__body"></div>
              </details>
              <details class="accounting-add-venue" data-venue="Concessions">
                <summary>Concessions</summary>
                <div class="accounting-add-venue__body"></div>
              </details>
            </div>

            <p class="accounting-add-hint">Enter pars by guest count. Values left blank are ignored.</p>
            <div class="accounting-add-actions">
              <button type="submit" class="save-btn">Add Recipe</button>
              <button type="reset" class="ghost-btn">Clear</button>
              <span id="accountingRecipeAddStatus" class="accounting-add-status" role="status" aria-live="polite"></span>
            </div>
          </fieldset>
        </form>

        <div class="table-wrap accounting-table" id="accountingRecipesInfoWrap">
          <table id="accountingRecipesInfoTable">
            <colgroup>
              <col class="col-recipes-number" />
              <col class="col-recipes-desc" />
              <col class="col-recipes-meta" />
              <col class="col-recipes-meta" />
              <col class="col-recipes-meta" />
              <col class="col-recipes-number" />
              <col class="col-recipes-meta" />
              <col class="col-recipes-number" />
              <col class="col-recipes-number" />
              <col class="col-recipes-actions" />
            </colgroup>
            <thead>
              <tr>
                <th scope="col">Recipe No.</th>
                <th scope="col">Description</th>
                <th scope="col">UOM</th>
                <th scope="col">Category</th>
                <th scope="col">Station</th>
                <th scope="col">Pan Weight</th>
                <th scope="col">Returns</th>
                <th scope="col">Cook Time</th>
                <th scope="col">Cost</th>
                <th scope="col" class="actions-header">Actions</th>
              </tr>
            </thead>
            <tbody id="accountingRecipesInfoBody"></tbody>
          </table>
        </div>

        <div class="table-wrap accounting-table" id="accountingRecipesParsWrap" hidden>
          <div class="accounting-pars-toolbar">
            <div class="accounting-pars-toolbar__left">
              <div class="accounting-pars-toggle" id="accountingRecipesParsMode" role="group" aria-label="Pars data source" data-mode="recipe" hidden>
                <button type="button" class="accounting-pars-toggle__btn accounting-pars-toggle__btn--active" data-pars-mode="recipe">Recipe Pars</button>
                <button type="button" class="accounting-pars-toggle__btn" data-pars-mode="prep">Prep Pars</button>
                <span class="accounting-pars-toggle__thumb" aria-hidden="true"></span>
              </div>
            </div>
            <div class="accounting-pars-toolbar__right">
              <div class="accounting-pars-loading" id="accountingParsSuggestionLoading" hidden aria-live="polite">
                <span class="accounting-pars-loading__dot" aria-hidden="true"></span>
                <span class="accounting-pars-loading__text">Loading suggestionsâ€¦</span>
              </div>
              <button type="button" class="save-btn accounting-pars-save-all" id="accountingRecipesSaveAll" hidden>Save All Pars</button>
              <span id="accountingRecipesSaveAllStatus" class="accounting-pars-status" role="status" aria-live="polite"></span>
            </div>
          </div>
          <table id="accountingRecipesParsTable">
            <colgroup id="accountingRecipesParsCols"></colgroup>
            <thead>
              <tr id="accountingRecipesParsHeader"></tr>
            </thead>
            <tbody id="accountingRecipesParsBody"></tbody>
          </table>
        </div>
        <p id="accountingRecipesEmpty" class="accounting-empty" hidden>No matches found.</p>
      </div>
    </div>
    <!-- [ACCOUNTING] END recipes -->


<script>
(function(){
  const nav = document.getElementById('analytics-nav');
  const tabs = nav?.querySelectorAll('.an-tab') || [];
  const sections = document.querySelectorAll('.analytics-section');
  const cogsOnly = document.querySelectorAll('.side-cogs-only');
  const copyTableBtn = document.getElementById('copyAnalyticsTableBtn');
  const copyStatusEl = document.getElementById('copyAnalyticsStatus');
  let copyStatusTimer = null;

  function show(tab){
    sections.forEach(s => s.style.display = (s.dataset.analytics === tab) ? 'block' : 'none');
    tabs.forEach(b => b.classList.toggle('active', b.dataset.analytics === tab));
    const isCogs = tab === 'cogs';
    cogsOnly.forEach(el => el.style.display = isCogs ? '' : 'none');
  }

  tabs.forEach(b => b.addEventListener('click', () => {
    show(b.dataset.analytics);
    window.refreshAnalyticsTab?.().catch(err => console.error('Analytics refresh failed', err));
  }));

  // Hook "Apply Filters" to run the correct loader (expects your JS functions to exist)
  document.getElementById('applyAnalyticsFilters')?.addEventListener('click', async () => {
    const start = document.getElementById('fStart')?.value;
    const end   = document.getElementById('fEnd')?.value;
    if (start) document.getElementById('drFrom').textContent = start;
    if (end)   document.getElementById('drTo').textContent = end;

    // Use your shared helper if present, else fall back
    let startTs, endTs, startStr, endStr;
    if (typeof getHawaiiRangeFromInputs === 'function') {
      const r = getHawaiiRangeFromInputs('fStart','fEnd');
      startTs = r.startTs; endTs = r.endTs; startStr = r.startStr; endStr = r.endStr;
    } else {
      startStr = start; endStr = end;
    }

    const active = [...tabs].find(t => t.classList.contains('active'))?.dataset.analytics || 'cogs';
    try {
      document.getElementById('analyticsLoading').style.display = '';
      if (active === 'cogs' && typeof loadFoodItemCOGS === 'function') {
        await loadFoodItemCOGS(startStr, endStr, startTs, endTs);
      } else if (active === 'timing' && typeof loadFoodTiming === 'function') {
        await loadFoodTiming(startStr, endStr, startTs, endTs);
      } else if (active === 'qty-per-guest' && typeof loadQtyPerGuest === 'function') {
        await loadQtyPerGuest(startStr, endStr, startTs, endTs);
      } else if (active === 'pan-weight' && typeof loadPanWeightAnalytics === 'function') {
        await loadPanWeightAnalytics(startStr, endStr, startTs, endTs);
      }
    } finally {
      document.getElementById('analyticsLoading').style.display = 'none';
    }
  });

  function showCopyStatus(message, isError){
    if (!copyStatusEl) return;
    copyStatusEl.textContent = message;
    copyStatusEl.style.display = 'inline';
    copyStatusEl.style.color = isError ? '#f87171' : '#9ca3af';
    if (copyStatusTimer) clearTimeout(copyStatusTimer);
    copyStatusTimer = setTimeout(() => {
      copyStatusEl.style.display = 'none';
      copyStatusEl.textContent = '';
    }, 3000);
  }

  function collectActiveTableData(section){
    if (!section) return '';
    const tables = Array.from(section.querySelectorAll('table')).filter(table => table.offsetParent !== null);
    if (!tables.length) return '';

    const sanitize = (value) => value.replace(/\s+/g, ' ').trim();

    return tables.map(table => {
      const rows = Array.from(table.querySelectorAll('tr'));
      const tableLines = rows.map(row => {
        const cells = Array.from(row.querySelectorAll('th,td')).map(cell => sanitize(cell.textContent || ''));
        if (cells.every(cell => cell.length === 0)) return '';
        return cells.join('\t');
      }).filter(line => line.length > 0);
      return tableLines.join('\n');
    }).filter(block => block.length > 0).join('\n\n');
  }

  copyTableBtn?.addEventListener('click', async () => {
    const activeTab = [...tabs].find(t => t.classList.contains('active'))?.dataset.analytics || 'cogs';
    const section = document.querySelector(`.analytics-section[data-analytics="${activeTab}"]`);

    if (!section || section.style.display === 'none'){
      showCopyStatus('No visible table to copy.', true);
      return;
    }
    if (!navigator?.clipboard?.writeText){
      showCopyStatus('Clipboard not supported in this browser.', true);
      return;
    }

    const text = collectActiveTableData(section);
    if (!text){
      showCopyStatus('Nothing to copy for this tab.', true);
      return;
    }

    try {
      await navigator.clipboard.writeText(text);
      showCopyStatus('Table copied to clipboard.', false);
    } catch (err){
      console.error('Failed to copy analytics table', err);
      showCopyStatus('Unable to copy table.', true);
    }
  });

  // default
  show('cogs');
})();
</script>

  </div>
</div>

  <!-- Chat Box -->

<!-- âœ… Chat floating dock -->
<div id="chatDock" class="chat-dock chat-dock--bottom-right" aria-live="polite">
  <button type="button" id="chatLauncher" class="chat-launcher" aria-expanded="false" aria-controls="chatBox" aria-label="Open Kitchen Chat">
    <span class="chat-launcher-icon" aria-hidden="true">ðŸ’¬</span>
    <span id="chatLauncherBadge" class="chat-launcher-badge"></span>
  </button>

  <div id="chatBox" class="chat-panel" role="dialog" aria-labelledby="chatTitle" aria-hidden="true" hidden>
    <div id="chatHeader" class="chat-header">
      <h3 id="chatTitle" class="chat-title">
        <span class="chat-title-label">ðŸ“¢ Kitchen Chat</span>
        <span class="chat-title-divider">â€“</span>
        <span id="currentVenueLabel" class="chat-title-venue">Main Kitchen</span>
        <span id="chatUnreadBadge" class="chat-unread-badge" aria-live="polite"></span>
      </h3>
      <button type="button" id="chatToggleBtn" class="chat-toggle-btn" aria-label="Close chat">Ã—</button>
    </div>

    <div id="chatMessages" class="chat-messages"></div>

    <div class="chat-input-row">
      <input id="chatInput" type="text" placeholder="Type your message..." />
      <button type="button" onclick="sendChatMessage()">Send</button>
    </div>
  </div>
</div>

<!-- ðŸ”´ Delete Confirmation Modal -->
<!-- ðŸ”´ Dark Themed Delete Confirmation Modal -->
<div id="deleteModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background-color:rgba(0,0,0,0.6); z-index:1000; justify-content:center; align-items:center; font-family:inherit;">
  <div style="background:var(--panel-bg); padding:24px; border-radius:10px; width:320px; text-align:center; color:var(--text); border:1px solid var(--border); box-shadow:0 0 15px rgba(0,0,0,0.5);">
    <h3 style="margin-bottom: 12px;">Confirm Deletion</h3>
    <p style="color:var(--text); opacity: 0.85;">Are you sure you want to delete this order?</p>
    <div style="margin-top: 24px; display: flex; justify-content: center; gap: 12px;">
      <button id="confirmDeleteBtn" style="background: crimson; color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
        Yes, Delete
      </button>
      <button onclick="closeDeleteModal()" style="background: var(--highlight); color: var(--text); border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- âœï¸ Edit Order Modal -->
<div id="editModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background-color:rgba(0,0,0,0.6); z-index:1001; justify-content:center; align-items:center; font-family:inherit;">
  <div style="background:var(--panel-bg); padding:24px; border-radius:10px; width:320px; text-align:center; color:var(--text); border:1px solid var(--border); box-shadow:0 0 15px rgba(0,0,0,0.5);">
    <h3 style="margin-bottom: 12px;">Edit Order</h3>

    <label for="editQty" style="display:block; margin-top:12px;">Quantity</label>
    <input type="number" id="editQty" min="0.01" step="0.01"
      style="width:100%; padding:8px; margin-top:6px; background:var(--highlight); border:1px solid var(--border); color:var(--text); border-radius:6px;">

    <label for="editNotes" style="display:block; margin-top:16px;">Notes</label>
    <textarea id="editNotes"
      style="width:100%; padding:8px; margin-top:6px; background:var(--highlight); border:1px solid var(--border); color:var(--text); border-radius:6px;"></textarea>

    <div style="margin-top: 24px; display: flex; justify-content: center; gap: 12px;">
      <button id="confirmEditBtn" style="background: var(--highlight); color: var(--text); border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
        Save Changes
      </button>
      <button onclick="closeEditModal()" style="background: crimson; color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
        Cancel
      </button>
    </div>
  </div>
</div>


  <!-- âœ… Scripts stay below everything -->
  </main>
  </div>
  <script type="module" src="./firebaseConfig.js"></script>
  <script type="module" src="./script.js"></script>
</body>
</html>



<style>
  /* Keep table headers visible and not overlapping rows */
  #analyticsDashboard table thead th {
    position: sticky;           /* stay put when the table scrolls */
    top: 0;
    z-index: 2;                 /* sit above row cells */
    background: #111;           /* opaque header bg so content doesn't "shine through" */
  }
  /* Optional: give the first data row a hair of top padding */
  #analyticsDashboard table tbody tr:first-child td {
    padding-top: 6px;
  }
</style>
<script>
  (function () {
    const stateEl = document.getElementById('scaleState');
    const lastEl  = document.getElementById('lastWeight');

    const origWrite = window._writeWeightToActiveInput;
    window._writeWeightToActiveInput = function (val) {
      try { if (lastEl) lastEl.textContent = `Last: ${val}`; } catch {}
      return origWrite ? origWrite(val) : undefined;
    };

    const origConnect = window.connectScaleSerial;
    if (origConnect) {
      window.connectScaleSerial = async function () {
        const r = await origConnect();
        if (stateEl && window._scale?.connected) stateEl.textContent = 'Connected';
        return r;
      };
    }
  })();
</script>
